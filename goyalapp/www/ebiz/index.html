
{% from "frappe/templates/includes/avatar_macro.html" import avatar %}
{% extends "templates/goyalweb.html" %}


{% block title %}
{{ _("My Account") }}
{% endblock %}
{% block page_content %}

<link rel='stylesheet' href='/assets/goyalapp/admin/style/style.css'></link>
<link rel='stylesheet' href='/assets/goyalapp/admin/style/MTMH.css'></link>
<link href='/assets/goyalapp/css/GAPI-ColorTheme.css' rel='stylesheet'></link>
<link href='/assets/goyalapp/css/GAPI-ThemeSite.css' rel='stylesheet'></link>
			<div class="wrapper">
				<div class="content-wrapper">
					<section class="content-header">
						<h1>View Markup</h1>
						<!-- <ol class="breadcrumb">
							<li><a href="" ng-click="navigateHome()"><i
									class="fa fa-dashboard"></i> Home</a></li>
							<li><a href="#">User</a></li>
							<li><a href="#">View All Users</a></li>
							<li class="active">View Markup</li>
						</ol> -->
					</section>
					<!-- Main content -->
					<section class="content">
						<div id="divLoading"></div>
						<div class="row">
							<div class="col-md-12">
								<div class="box">
									
									<div class="box-header with-border">
									<div class="col-md-9">
										<div class="col-md-3">
											<input type="date" name="start-date" id="start-date" class="form-control mt-3 col-md m-3">
										</div>
										<div class="col-md-3">
											<input type="date" name="end-date" id="end-date" class="form-control mt-3 col-md m-3">
										</div>
										<div class="col-md-3">
							                <button class="btn btn-primary form-control" style="margin-top: 10px;" id="update">{{ _("Fetch") }}</button>
										</div>
										<div class="col-md-3">
										</div>

									</div>
									<div class="col-md-3">
									</div>
								</div>
									
									<div class="box-body">
										<form class="form-horizontal">
											<div class="form-group">

												<div class="clearfix"></div>
												<div class="col-md-12">
													<div class="responsive-table table-container">
													<table id="example2"
														class="table table-bordered table-hover dataTable"
														role="grid" aria-describedby="example2_info">
														<thead>
															<tr role="row">
															<th colspan="1" rowspan="1" class="sorting"
														aria-controls="example2" aria-label="" tabindex="0">
														<label class="Airlines"><input
															id="checkAll" type="checkbox" ng-model="checkAll"
															ng-change="selectAll()"> <span
															class="checkmark"></span>
													</label>
													</th>
																<th width="8%" colspan="1" rowspan="1"
																	class="sorting_desc" aria-controls="example2"
																	aria-label="" aria-sort="descending" tabindex="0">Carrier</th>
																	<th width="8%" colspan="1" rowspan="1"
																	class="sorting_desc" aria-controls="example2"
																	aria-label="" aria-sort="descending" tabindex="0">Category</th>
																<th width="8%" colspan="1" rowspan="1"
																	class="sorting_desc" aria-controls="example2"
																	aria-label="" aria-sort="descending" tabindex="0">Service
																	Type</th>
																<th width="8%" colspan="1" rowspan="1"
																	class="sorting_desc" aria-controls="example2"
																	aria-label="" aria-sort="descending" tabindex="0">Base
																	Fare %</th>
																<th width="13%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">YQ
																	%</th>
																<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">Flat Markup</th>
																	<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">% Markup</th>
																	<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">Created On</th>
																	<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">Company</th>
																	<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">Status</th>
																	
																	<th width="10%" colspan="1" rowspan="1" class="sorting"
																	aria-controls="example2" aria-label="" tabindex="0">Select</th>

															</tr>
														<tbody>
															<tr role="row" class="even table-row"
																ng-repeat="markup in ctrl.markupList">
																<td data-label="Ticket No">
														<div class="input-group">
															<label class=" Airlines"> <input type="checkbox"
																ng-model="markup.selected"> <span
																class="checkmark"></span>
															</label>
														</div>
													</td>
																<td>1</td>
																<td>2</td>
																<td>3</td>
																<td>4</td>
																<td>5</td>
																<td>6</td>
																<td>7</td>
																<td>8</td>
																<td>9</td>
																<td>10</td>
																<td><div class="dropdown">
													<button class="dropbtn">Select</button>
													<div class="dropdown-content">
														<a href="" style="color: blue;"> Edit</a> 
													</div>
												</div> 
												</td>

															</tr>
															<!-- </c:forEach>    -->
														</tbody>
														<tfoot>

														</tfoot>
													</table>
													</div>
												</div>

											</div>

										</form>
									</div>
									<!-- /.box-body -->
									<div class="box-footer"></div>
									<!-- /.box-footer-->
								</div>
							</div>
						</div>
					</section>
				</div>
				<div class="control-sidebar-bg"></div>
			</div>

<script>

frappe.ready(function() {
	if(frappe.utils.get_url_arg("key")) {
		$("#old_password").parent().toggle();
	}

	if(frappe.utils.get_url_arg("password_expired")) {
		$(".password-box").html("{{ _('The password of your account has expired.') }}");
	}

	$("#reset-password").on("submit", function() {
		return false;
	});

	$("#new_password").on("keypress", function(e) {
		if(e.which===13) $("#update").click();
	})
	
	function on_date_or_timezone_select() {
        	frappe.throw(__('SG is HEREe'));
	    let date_picker = document.getElementById('appointment-date');
	    let timezone = document.getElementById('appointment-timezone');
		    if (date_picker.value === '') {
	        clear_time_slots();
    	    hide_next_button();
        	frappe.throw(__('Please select a date'));
    	}
    	window.selected_date = date_picker.value;
    	window.selected_timezone = timezone.value;
    	update_time_slots(date_picker.value, timezone.value);
    	let lead_text = document.getElementById('lead-text');
    		lead_text.innerHTML = __("Select Time")
	}

	$("#update").click(function() {
		var args = {
			key: frappe.utils.get_url_arg("key") || "",
			old_password: $("#old_password").val(),
			new_password: $("#new_password").val(),
			logout_all_sessions: 1
		}
		const confirm_password = $('#confirm_password').val()
		if (!args.old_password && !args.key) {
			frappe.msgprint({
				title: "{{ _('Missing Value') }}",
				message: "{{ _('Please enter your old password.') }}",
				clear: true
			});
		}
		if (!args.new_password) {
			frappe.msgprint({
				title: "{{ _('Missing Value') }}",
				message: "{{ _('Please enter your new password.') }}",
				clear: true
			});
		}
		if (args.new_password !== confirm_password) {
			$('.password-mismatch-message').text("{{ _('Passwords do not match') }}")
				.removeClass('hidden text-muted').addClass('text-danger');
			return false;
		}

		frappe.call({
			type: "POST",
			method: "frappe.core.doctype.user.user.update_password",
			btn: $("#update"),
			args: args,
			statusCode: {
				401: function() {
					$(".page-card-head .reset-password-heading").text("{{ _('Invalid Password') }}");
				},
				410: function({ responseJSON }) {
					const title = "{{ _('Invalid Link') }}";
					const message = responseJSON.message;
					$(".page-card-head .reset-password-heading").text(title);
					frappe.msgprint({ title: title, message: message, clear: true });
				},
				200: function(r) {
					$("input").val("");
					strength_indicator.addClass("hidden");
					strength_message.addClass("hidden");
					$(".page-card-head .reset-password-heading")
						.html("{{ _('Status Updated') }}");
					if(r.message) {
						frappe.msgprint({
							title: "{{ _('Password set') }}",
							message: "{{ _('Your new password has been set successfully.') }}",
							// password is updated successfully
							// clear any server message
							clear: true
						});
						setTimeout(function() {
							window.location.href = r.message;
						}, 2000);
					}
				}
			}
		});

		return false;
	});

	window.strength_indicator = $('.password-strength-indicator');
	window.strength_message = $('.password-strength-message');

	$('#new_password').on('keyup', function() {
		window.clear_timeout();
		window.timout_password_strength = setTimeout(window.test_password_strength, 200);
	});

	window.test_password_strength = function() {
		window.timout_password_strength = null;

		var args = {
			key: frappe.utils.get_url_arg("key") || "",
			old_password: $("#old_password").val(),
			new_password: $("#new_password").val()
		}

		if (!args.new_password) {
			set_strength_indicator('grey', {'warning': "{{ _('Please enter the password') }}" });
			return;
		}

		return frappe.call({
			method: 'frappe.core.doctype.user.user.test_password_strength',
			args: args,
			callback: function(r) {
				console.log(r.message);
			},
			statusCode: {
				401: function() {
					$('.page-card-head .reset-password-heading')
						.text("{{ _('Invalid Password') }}");
				},
				200: function(r) {
					if (r.message) {
						var score = r.message.score,
							feedback = r.message.feedback;

						feedback.score = score;

						if(feedback.password_policy_validation_passed){
							set_strength_indicator('green', feedback);
						}else{
							set_strength_indicator('red', feedback);
						}
					}
				}
			}

		});
	};

	window.set_strength_indicator = function(color, feedback) {
		var message = [];
		feedback.help_msg = "";
		if(!feedback.password_policy_validation_passed){
			feedback.help_msg = "<br>" + "{{ _('Hint: Include symbols, numbers and capital letters in the password') }}";
		}
		if (feedback) {
			if(!feedback.password_policy_validation_passed){
				if (feedback.suggestions && feedback.suggestions.length) {
					message = message.concat(feedback.suggestions);
				} else if (feedback.warning) {
					message.push(feedback.warning);
				}
				message.push(feedback.help_msg);

			} else {
				message.push("{{ _('Success! You are good to go 👍') }}");
			}
		}
		strength_message.html(message.join(' ') || '').removeClass('hidden');
	}

	window.clear_timeout = function() {
		if (window.timout_password_strength) {
			clearTimeout(window.timout_password_strength);
			window.timout_password_strength = null;
		}
	};
});

</script>


{% endblock %}